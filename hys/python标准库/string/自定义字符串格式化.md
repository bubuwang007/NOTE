内置的字符串类提供了通过使用 [**PEP 3101**](https://www.python.org/dev/peps/pep-3101) 所描述的 [`format()`](https://www.bookstack.cn/read/python-3.10.0-zh/7adaf5f79c9e977a.md#str.format) 方法进行复杂变量替换和值格式化的能力。 [`string`](https://www.bookstack.cn/read/python-3.10.0-zh/1cb7b20c32bbf2f2.md#module-string) 模块中的 [`Formatter`](https://www.bookstack.cn/read/python-3.10.0-zh/1cb7b20c32bbf2f2.md#string.Formatter) 类允许你使用与内置 [`format()`](https://www.bookstack.cn/read/python-3.10.0-zh/7adaf5f79c9e977a.md#str.format) 方法相同的实现来创建并定制你自己的字符串格式化行为。

*class* `string.Formatter`

[`Formatter`](https://www.bookstack.cn/read/python-3.10.0-zh/1cb7b20c32bbf2f2.md#string.Formatter) 类包含下列公有方法：

- `format`(*format_string*, */*, **args\*,\*** kwargs*)

  首要的 API 方法。 它接受一个格式字符串和任意一组位置和关键字参数。 它只是一个调用 [`vformat()`](https://www.bookstack.cn/read/python-3.10.0-zh/1cb7b20c32bbf2f2.md#string.Formatter.vformat) 的包装器。

  在 3.7 版更改: 格式字符串参数现在是 [仅限位置参数](https://www.bookstack.cn/read/python-3.10.0-zh/bd6b000ceb39b61e.md#positional-only-parameter)。

- `vformat`(*format_string*, *args*, *kwargs*)

  此函数执行实际的格式化操作。 它被公开为一个单独的函数，用于需要传入一个预定义字母作为参数，而不是使用 `*args` 和 `**kwargs` 语法将字典解包为多个单独参数并重打包的情况。 [`vformat()`](https://www.bookstack.cn/read/python-3.10.0-zh/1cb7b20c32bbf2f2.md#string.Formatter.vformat) 完成将格式字符串分解为字符数据和替换字段的工作。 它会调用下文所述的几种不同方法。

此外，[`Formatter`](https://www.bookstack.cn/read/python-3.10.0-zh/1cb7b20c32bbf2f2.md#string.Formatter) 还定义了一些旨在被子类替换的方法：

- `parse`(*format_string*)

  循环遍历 format_string 并返回一个由可迭代对象组成的元组 (*literal_text*, *field_name*, *format_spec*, *conversion*)。 它会被 [`vformat()`](https://www.bookstack.cn/read/python-3.10.0-zh/1cb7b20c32bbf2f2.md#string.Formatter.vformat) 用来将字符串分解为文本字面值或替换字段。

  元组中的值在概念上表示一段字面文本加上一个替换字段。 如果没有字面文本（如果连续出现两个替换字段就会发生这种情况），则 *literal_text* 将是一个长度为零的字符串。 如果没有替换字段，则 *field_name*, *format_spec* 和 *conversion* 的值将为 `None`。

- `get_field`(*field_name*, *args*, *kwargs*)

  给定 *field_name* 作为 [`parse()`](https://www.bookstack.cn/read/python-3.10.0-zh/1cb7b20c32bbf2f2.md#string.Formatter.parse) (见上文) 的返回值，将其转换为要格式化的对象。 返回一个元组 (obj, used_key)。 默认版本接受在 [**PEP 3101**](https://www.python.org/dev/peps/pep-3101) 所定义形式的字符串，例如 “0[name]“ 或 “label.title”。 *args* 和 *kwargs* 与传给 [`vformat()`](https://www.bookstack.cn/read/python-3.10.0-zh/1cb7b20c32bbf2f2.md#string.Formatter.vformat) 的一样。 返回值 *used_key* 与 [`get_value()`](https://www.bookstack.cn/read/python-3.10.0-zh/1cb7b20c32bbf2f2.md#string.Formatter.get_value) 的 *key* 形参具有相同的含义。

- `get_value`(*key*, *args*, *kwargs*)

  提取给定的字段值。 *key* 参数将为整数或字符串。 如果是整数，它表示 *args* 中位置参数的索引；如果是字符串，它表示 *kwargs* 中的关键字参数名。

  *args* 形参会被设为 [`vformat()`](https://www.bookstack.cn/read/python-3.10.0-zh/1cb7b20c32bbf2f2.md#string.Formatter.vformat) 的位置参数列表，而 *kwargs* 形参会被设为由关键字参数组成的字典。

  对于复合字段名称，仅会为字段名称的第一个组件调用这些函数；后续组件会通过普通属性和索引操作来进行处理。

  因此举例来说，字段表达式 ‘0.name’ 将导致调用 [`get_value()`](https://www.bookstack.cn/read/python-3.10.0-zh/1cb7b20c32bbf2f2.md#string.Formatter.get_value) 时附带 *key* 参数值 0。 在 [`get_value()`](https://www.bookstack.cn/read/python-3.10.0-zh/1cb7b20c32bbf2f2.md#string.Formatter.get_value) 通过调用内置的 [`getattr()`](https://www.bookstack.cn/read/python-3.10.0-zh/343ac5efc1fa2896.md#getattr) 函数返回后将会查找 `name` 属性。

  如果索引或关键字引用了一个不存在的项，则将引发 [`IndexError`](https://www.bookstack.cn/read/python-3.10.0-zh/177bd954d1cc6696.md#IndexError) 或 [`KeyError`](https://www.bookstack.cn/read/python-3.10.0-zh/177bd954d1cc6696.md#KeyError)。

- `check_unused_args`(*used_args*, *args*, *kwargs*)

  在必要时实现对未使用参数进行检测。 此函数的参数是是格式字符串中实际引用的所有参数键的集合（整数表示位置参数，字符串表示名称参数），以及被传给 vformat 的 *args* 和 *kwargs* 的引用。 未使用参数的集合可以根据这些形参计算出来。 如果检测失败则 [`check_unused_args()`](https://www.bookstack.cn/read/python-3.10.0-zh/1cb7b20c32bbf2f2.md#string.Formatter.check_unused_args) 应会引发一个异常。

- `format_field`(*value*, *format_spec*)

  [`format_field()`](https://www.bookstack.cn/read/python-3.10.0-zh/1cb7b20c32bbf2f2.md#string.Formatter.format_field) 会简单地调用内置全局函数 [`format()`](https://www.bookstack.cn/read/python-3.10.0-zh/343ac5efc1fa2896.md#format)。 提供该方法是为了让子类能够重载它。

- `convert_field`(*value*, *conversion*)

  使用给定的转换类型（来自 [`parse()`](https://www.bookstack.cn/read/python-3.10.0-zh/1cb7b20c32bbf2f2.md#string.Formatter.parse) 方法所返回的元组）来转换（由 [`get_field()`](https://www.bookstack.cn/read/python-3.10.0-zh/1cb7b20c32bbf2f2.md#string.Formatter.get_field) 所返回的）值。 默认版本支持 ‘s’ (str), ‘r’ (repr) 和 ‘a’ (ascii) 等转换类型。